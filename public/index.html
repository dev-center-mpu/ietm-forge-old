<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8">
  <title>ИЭТР</title>

  <!-- The Viewer CSS -->
  <link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/6.*/style.min.css"
    type="text/css">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
  <link rel="stylesheet" href="css/bootstrap-treeview.min.css">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  <link rel="stylesheet" href="css/main.css">

  <!-- Developer CSS -->
  <style>
    #MyViewerDiv {
      width: 100%;
      height: 100%;
      margin: 0;
      background-color: #F0F8FF;
    }

    * {
      padding: 0;
      margin: 0;
    }

    body {
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: 18% 41% 41%;
      grid-template-rows: 100%;
    }

    #left {
      grid-column-start: 1;
      grid-column-end: 1;
      grid-row-start: 1;
      grid-row-end: 1;
    }

    #right {
      padding: 24px;
      grid-column-start: 3;
      grid-column-end: 3;
      grid-row-start: 1;
      grid-row-end: 1;
    }

    #viewer {
      position: relative;
      grid-column-start: 2;
      grid-column-end: 2;
      grid-row-start: 1;
      grid-row-end: 1;
    }

    .btn-success {
      height: 32px;
      border-radius: 0 4px 4px 0;
      color: white;
      font-weight: 700;
    }
  </style>
</head>

<body>
  <div id="left" class="list-group">
    <h2 class="text-center">Дерево</h2>
    <!-- <form> -->
    <!-- <div class="input-group mb-3">
              <label for="input-search" class="sr-only">Search Tree:</label>
              <div class="pull-left">
                  <input type="input" class="form-control" id="input-search" placeholder="Type to search..." value="">
              </div>
              <div class="pull-left">
                <button type="button" class="btn btn-success" id="btn-search">Поиск</button>
            </div>
              <button type="button" class="btn btn-default" id="btn-clear-search">Очистить</button>
          </div>
       -->

    <div class="input-group mb-3" style="margin-left: 10px">
      <input type="input" class="form-control" id="input-search" placeholder="Поиск..." value="" />
      <span class="input-group-addon input-group-addon-btn bg-white"
        style="padding: 0; margin: 0; border-radius: 0px 5px 5px 0px">
        <button class="btn btn-success" type="button" id="btn-clear-search">Поиск</button>
      </span>
    </div>
    <!-- </form> -->
    <div id="tree"></div>
  </div>
  </div>
  <div id="viewer">
    <div id="player">
      <div id="playerControls">
        <span id="playBtn" class="text-primary">▶</span>
        <span id="pauseBtn" class="text-primary" style="display: none">❙❙</span>
        <input type="range" value="0" step="0.01" class="custom-range" id="customRange1">
        <span id="time"> 0:00 / 0:00</span>
      </div>
    </div>
  </div>
  <div id="right">
    <h2>Заголовок</h2>
    <p>Редуктор это круто</p>

  </div>

  <!-- The Viewer will be instantiated here -->

  <script src="http://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
    </script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>

  <!-- The Viewer JS -->
  <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/6.*/viewer3D.min.js"></script>

  <script src="scripts/ietm.js"></script>
  <script src="scripts/main.js"></script>
  <script src="scripts/bootstrap-treeview.min.js"></script>
  <script>
    var tree = [{
        text: "Техническое описание",
        id: "item1"
      },
      {
        text: "Каталог деталей",
        id: "item2",
        nodes: [{
            text: "Корпус",
            id: "item2_1"
          },
          {
            text: "Зубчатая передача",
            id: "item2_2"
          },
          {
            text: "Двигатель",
            id: "item2_3"
          },
          {
            text: "Тихоходный",
            id: "item2_4"
          },
          {
            text: "Подшипники",
            id: "item2_5"
          }
        ]
      },
      {
        text: "Принцип работы",
        id: "item3",
        nodes: [{
          text: "Корпус",
          id: "item3_1"
        }]
      },
      {
        text: "Руководство по разработке",
        id: "item4",
        nodes: [{
            text: "Разборка корпуса",
            id: "item4_1"
          },
          {
            text: "Замена шестерней",
            id: "item4_2"
          }
        ]
      },
      {
        text: "Руководство по эксплуатации",
        id: "item5",
        nodes: [{
          text: "Смазывание компонентов",
          id: "item5_1"
        }]
      }
    ];


    //Текст с деталей брать тут

    var $tree = $('#tree').treeview({
      expandIcon: 'glyphicon glyphicon-chevron-right',
      collapseIcon: 'glyphicon glyphicon-chevron-down',
      nodeIcon: 'glyphicon glyphicon-file',
      data: tree,
      multiSelect: $('#chk-select-multi').is(':checked'),
      onNodeSelected: function (event, node) {
        console.log(node.id+" was selected");
        $('#selectable-output').prepend('<p>' + node.text + ' was selected</p>');
      },
      onNodeUnselected: function (event, node) {
        console.log(node.id+" was unselected");
        $('#selectable-output').prepend('<p>' + node.text + ' was unselected</p>');
      }

    });

    var search = function (e) {
      var pattern = $('#input-search').val();
      var options = {
        ignoreCase: true
      };
      var results = $tree.treeview('search', [pattern, options]);

      var output = '<p>' + results.length + ' matches found</p>';
      $.each(results, function (index, result) {
        output += '<p>- ' + result.text + '</p>';
      });
      $('#search-output').html(output);
    }

    $('#btn-search').on('click', search);
    $('#input-search').on('keyup', search);

    $('#btn-clear-search').on('click', function (e) {
      $tree.treeview('clearSearch');
      $('#input-search').val('');
      $('#search-output').html('');
    });




    //////




    var findSelectableNodes = function () {
      return $tree.treeview('search', [$('#input-select-node').val(), {
        ignoreCase: false,
        exactMatch: false
      }]);
    };
    var selectableNodes = findSelectableNodes();

    $('#chk-select-multi:checkbox').on('change', function () {
      console.log('multi-select change');
      $tree = initSelectableTree();
      selectableNodes = findSelectableNodes();
    });

    // Select/unselect/toggle nodes
    $('#input-select-node').on('keyup', function (e) {
      selectableNodes = findSelectableNodes();
      $('.select-node').prop('disabled', !(selectableNodes.length >= 1));
    });

    $('#btn-select-node.select-node').on('click', function (e) {
      $tree.treeview('selectNode', [selectableNodes, {
        silent: $('#chk-select-silent').is(':checked')
      }]);
    });

    $('#btn-unselect-node.select-node').on('click', function (e) {
      $tree.treeview('unselectNode', [selectableNodes, {
        silent: $('#chk-select-silent').is(':checked')
      }]);
    });

    $('#btn-toggle-selected.select-node').on('click', function (e) {
      $tree.treeview('toggleNodeSelected', [selectableNodes, {
        silent: $('#chk-select-silent').is(':checked')
      }]);
    });
  </script>